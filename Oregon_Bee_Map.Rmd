---
title: "Bee Oregon Map Figure"
output: html_document
date: "2024-11-26"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
library(terra)
library(sf)

```

```{r Bombus observations across oregon}
complete_bee_data <- read_rds("Data/final_bee_dataset")

# making our data into a shapefile for plotting
bombus_shp <- st_as_sf(complete_bee_data,
                                   coords = c("Dec..Long.", "Dec..Lat."),
                                   crs = st_crs("EPSG:4326"), na.fail = FALSE	
)

# downloading in the Oregon base map 
or <- map_data("county", "oregon")%>% 
  dplyr::select(lon = long, lat, group, id = subregion)

# first need to create the extent from the or dataframe
min_long <- min(or$lon)
max_long <- max(or$lon)
min_lat <- min(or$lat)
max_lat <- max(or$lat)

or_extent <- c(xmin = min_long, xmax = max_long, ymin = min_lat, ymax = max_lat)

# create bounding box
bbox <- st_bbox(or_extent, crs = st_crs(bombus_shp))
# concert bbox to sf polygon
bbox_poly <- st_as_sfc(bbox)
# crop shapefile using bounding box
cropped_bombus_shp <- st_intersection(bombus_shp, bbox_poly)


# plotting!
ggplot() +
  geom_polygon(data=or, aes(x=lon, y=lat, group=group)) +
  geom_sf(data = cropped_bombus_shp, aes(color = Species)) +
  scale_color_viridis_d(name = "Species") + 
  ggtitle("4 Bombus sp. Observations Across Oregon") + 
  scale_color_manual(
    values = c("red", "white", "forestgreen", "violet"), # Custom colors for each species
    name = "Species"
  ) 
```

```{r Census Blocks Plot}

census_shp <- st_read("Data/CensusBlockGroups/CensusBlockGroups.shp")
census_csv <- read.csv("CensusBlockGroups.csv")

ggplot() +
  geom_polygon(data=or, aes(x=lon, y=lat, group=group), fill = "tan")

census_shp <- census_shp %>%
  mutate(pop_bin = cut(POP20, breaks = c(0, 3000, 4000,5000, 6000, Inf),
                       labels = c("0-3k", "3k-4k","4k-5k", "5k-6k", "6k+"),
                       include.lowest = TRUE))

ggplot() +
   # census block layer
  #geom_sf(data = census_shp, aes(fill = COUNTY)) + 
  geom_sf(data = census_shp, aes(fill = POP20)) + 
  geom_sf(data = complete_bee_data, aes(color = springTemp)) +
  scale_color_gradient(low="lightblue", high="red") + ggtitle("Map of Avg Spring Temp (Feb-June) and Census Block Population Info") + theme(plot.title = element_text(hjust = 0.5)) + 
  # filling the blocks based on population AND adding legend for this (using a binned color scale)
  scale_fill_viridis_c(option = "H", name = "Population") + 
  xlab("lon") + ylab("lat")
  


```
```{r climate plot?}

# using the temperatures in April/beginning of spring is what I was thinking 
complete_bee_data <- cropped_bombus_shp %>%
  rowwise() %>%
  mutate(springTemp = mean(c_across(c("tmean_6", "tmean_7", 
                                      "tmean_8", "tmean_9", "tmean_10")), na.rm = TRUE)) %>%
  ungroup()

ggplot() +
  geom_polygon(data=or, aes(x=lon, y=lat, group=group)) +
  geom_sf(data = complete_bee_data, aes(color = springTemp)) +
  scale_color_gradient(low="lightblue", high="red") + ggtitle("Average Spring (Feb-June) Temperatures (Â°C)") + theme(plot.title = element_text(hjust = 0.5))



```
